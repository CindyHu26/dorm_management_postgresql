import streamlit as st
from data_models import maintenance_model

def render():
    """æ¸²æŸ“ã€Œç³»çµ±ç¶­è­·ã€é é¢"""
    st.header("ç³»çµ±ç¶­è­·å·¥å…·")

    st.markdown("---")

    # --- æ—¥æœŸæ ¼å¼æ ¡æ­£å·¥å…· ---
    with st.container(border=True):
        st.subheader("è³‡æ–™åº«æ—¥æœŸæ ¼å¼ä¸€éµæ ¡æ­£")
        st.warning("è­¦å‘Šï¼šé€™æ˜¯ä¸€å€‹é«˜éšç¶­è­·å·¥å…·ï¼Œå®ƒå°‡æœƒä¿®æ”¹è³‡æ–™åº«ä¸­æ‰€æœ‰è¡¨æ ¼çš„æ—¥æœŸæ ¼å¼ã€‚è«‹åœ¨é‡åˆ°å„€è¡¨æ¿æ•¸æ“šç•°å¸¸ï¼ˆä¾‹å¦‚äººæ•¸ç‚º0ï¼‰æ™‚ï¼Œæ‰è¬¹æ…ä½¿ç”¨ã€‚")
        st.info("åŸ·è¡Œæ­¤å·¥å…·å‰ï¼Œå¼·çƒˆå»ºè­°è¤‡è£½'dorm_management.db'å‚™ä»½æ‚¨çš„è³‡æ–™åº«ã€‚")

        if st.button("ğŸš€ é–‹å§‹åŸ·è¡Œæ—¥æœŸæ ¼å¼æ ¡æ­£", type="primary"):
            with st.spinner("æ­£åœ¨å…¨é¢æƒæä¸¦æ ¡æ­£è³‡æ–™åº«æ—¥æœŸæ ¼å¼ï¼Œè«‹ç¨å€™..."):
                report = maintenance_model.fix_all_date_formats()
            
            st.success("æ ¡æ­£ç¨‹åºåŸ·è¡Œå®Œç•¢ï¼")
            
            st.subheader("åŸ·è¡Œå ±å‘Š:")
            # ä½¿ç”¨ st.code ä¾†é¡¯ç¤ºå¤šè¡Œå ±å‘Šï¼Œæ ¼å¼æ›´æ¸…æ™°
            st.code("\n".join(report))

            # æ¸…é™¤æ‰€æœ‰å¿«å–ï¼Œç¢ºä¿ä¸‹æ¬¡è¼‰å…¥æ™‚èƒ½è®€åˆ°æœ€æ–°çš„ã€å·²æ ¡æ­£çš„è³‡æ–™
            st.cache_data.clear()
            st.info("æ‰€æœ‰æ‡‰ç”¨ç¨‹å¼å¿«å–å·²æ¸…é™¤ï¼Œè«‹é‡æ–°æ•´ç†é é¢æˆ–åˆ‡æ›åˆ°å…¶ä»–é é¢ä»¥æŸ¥çœ‹æœ€æ–°æ•¸æ“šã€‚")